<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Failure Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<h2>ğŸ“Š Failure Dashboard</h2>

<canvas id="failureChart" width="800" height="400"></canvas>

<script>
const ws = new WebSocket("ws://localhost:8000/failures/ws/today");

const ctx = document.getElementById('failureChart').getContext('2d');

// à¸Šà¸·à¹ˆà¸­à¸ªà¸–à¸²à¸™à¸µà¹ƒà¸™à¸¥à¸³à¸”à¸±à¸š
const stations = [
    "vflash1", "hipot1", "ats1", "heatup", "burnin", "hipot2", "ats2", "vflash2", "ats3"
];

// à¹€à¸•à¸£à¸µà¸¢à¸¡ Chart.js
const chart = new Chart(ctx, {
    type: 'bar',
    data: {
        labels: stations,
        datasets: [{
            label: 'Failure count',
            data: Array(stations.length).fill(0),
            backgroundColor: 'rgba(75, 192, 192, 0.5)',
            borderColor: 'rgba(75, 192, 192, 1)',
            borderWidth: 1
        }]
    },
    options: {
        scales: {
            y: {
                beginAtZero: true
            }
        }
    }
});

ws.onopen = () => {
    console.log("âœ… WebSocket connected");
};

ws.onmessage = (event) => {
    const data = JSON.parse(event.data);

    if (data.length > 0) {
        const latest = data[data.length - 1];
        const values = stations.map(s => latest[s]);
        chart.data.datasets[0].data = values;
        chart.update();
    }
};

ws.onclose = () => {
    console.log("âŒ WebSocket disconnected");
};
</script>

</body>
</html>
