<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <title>Failures Heatup Data</title>
    <style>
        table {
            border-collapse: collapse;
            width: 80%;
            margin: 20px auto;
        }

        th, td {
            border: 1px solid #333;
            padding: 8px 12px;
            text-align: left;
        }

        th {
            background-color: #eee;
        }

        tfoot td {
            font-weight: bold;
            background-color: #ddd;
            text-align: right;
        }
    </style>
</head>
<body>
<h2 style="text-align:center;">Failures Heatup Data</h2>
<table id="failuresTable">
    <thead>
    <tr>
        <th>Tester ID</th>
        <th>Fail Item</th>
        <th>Work Date</th>
    </tr>
    </thead>
    <tbody>
    <!-- ข้อมูลจะถูกเติมที่นี่ด้วย JS -->
    </tbody>
    <tfoot>
      <tr>
        <td colspan="3" id="totalCount">Total: 0</td>
      </tr>
    </tfoot>
</table>

<script>
    async function loadFailures() {
        try {
            const response = await fetch('http://localhost:8000/failures/heatup');
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

            const data = await response.json();

            const tbody = document.querySelector('#failuresTable tbody');
            tbody.innerHTML = ''; // ล้างก่อน

            data.forEach(item => {
                const formattedDate = item.workDate.replace('T', ' ');

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${item.testerId}</td>
                    <td>${item.failItem}</td>
                    <td>${formattedDate}</td>
                `;
                tbody.appendChild(tr);
            });

            // แสดงจำนวน total ด้านล่าง
            const totalCountElem = document.getElementById('totalCount');
            totalCountElem.textContent = `Total: ${data.length}`;

        } catch (error) {
            console.error('Error loading data:', error);
            alert('Error loading data: ' + error.message);
        }
    }

    loadFailures();
</script>
</body>
</html>
